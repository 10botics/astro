---
import { Image } from 'astro:assets';
import { generateTagSlug, AUDIENCE_TAG_MAPPING } from '../../utils/courseMappings';

export interface Props {
  title: string;
  subtitle: string;
  tags: string[];
  videoId?: string;
  description: string;
  featuredImage?: any;
  heroImage?: any;
}

const { title, subtitle, tags, videoId, description, featuredImage, heroImage } = Astro.props;
---

<!-- Clean white background to match original -->
<section class="bg-white py-8">
  <div class="container mx-auto px-4 max-w-6xl">
    <!-- Breadcrumbs - exact match to original style -->
    <nav class="text-sm mb-6 text-gray-600">
      <a href="/" class="text-cyan-400 hover:text-cyan-600">首頁</a>
      <span class="mx-2">»</span>
      <a href="/school-courses/" class="text-cyan-400 hover:text-cyan-600">到校課程</a>
      <span class="mx-2">»</span>
      <span class="text-gray-800">{title}</span>
    </nav>

    <!-- Title Section - match original typography -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-4" style="color: #1e293b;">{title}</h1>
      <p class="text-xl text-gray-700 mb-6">{subtitle}</p>
      
      <!-- Separate target audience and other tags -->
      {(() => {
        const targetAudienceTags = ['初小', '高小', '初中', '高中'];
        const audienceTags = tags.filter(tag => targetAudienceTags.includes(tag));
        const otherTags = tags.filter(tag => !targetAudienceTags.includes(tag));
        
        return (
          <div class="space-y-4 mb-8">
            {/* Target Audience */}
            {audienceTags.length > 0 && (
              <div class="flex flex-wrap gap-1 items-center">
                <i class="fas fa-users text-cyan-400 mr-2"></i>
                <span class="text-sm font-medium text-gray-700 mr-2">適合對象:</span>
                {audienceTags.map((tag, index) => {
                  const tagSlug = AUDIENCE_TAG_MAPPING[tag as keyof typeof AUDIENCE_TAG_MAPPING] || tag.toLowerCase().replace(/\s+/g, '-');
                  
                  return (
                    <span class="text-sm">
                      <a href={`/tag/${tagSlug}`} class="bg-cyan-100 text-cyan-800 px-2 py-1 rounded text-xs font-medium hover:bg-cyan-200 transition-colors">
                        {tag}
                      </a>
                      {index < audienceTags.length - 1 && <span class="text-gray-400 mx-1">,</span>}
                    </span>
                  );
                })}
              </div>
            )}
            
            {/* Other Tags */}
            {otherTags.length > 0 && (
              <div class="flex flex-wrap gap-1 items-center">
                <i class="fas fa-tags text-cyan-400 mr-2"></i>
                {otherTags.map((tag, index) => {
                  const tagSlug = generateTagSlug(tag);
                  
                  return (
                    <span class="text-sm">
                      <a href={`/tag/${tagSlug}`} 
                         class="text-cyan-400 hover:text-cyan-600 transition-colors">
                        {tag}
                      </a>
                      {index < otherTags.length - 1 && <span class="text-gray-400 mx-1">,</span>}
                    </span>
                  );
                })}
              </div>
            )}
          </div>
        );
      })()}
    </div>
  </div>
</section>

<!-- Video and Description Section - match original layout -->
<section class="bg-white py-8">
  <div class="container mx-auto px-4 max-w-6xl">
    <div class="grid lg:grid-cols-2 gap-12 items-start">
      <!-- Video/Image Section - exact positioning as original -->
      <div class="order-1">
        {videoId ? (
          <div class="aspect-video bg-black rounded-lg overflow-hidden shadow-lg">
            <iframe 
              src={`https://www.youtube.com/embed/${videoId}?controls=1&rel=0`}
              class="w-full h-full"
              frameborder="0"
              allowfullscreen
              title="課程簡介影片">
            </iframe>
          </div>
        ) : heroImage ? (
          <div class="aspect-video bg-gray-100 rounded-lg overflow-hidden shadow-lg">
            <Image 
              src={heroImage} 
              alt={title}
              width={600}
              height={400}
              class="w-full h-full object-cover"
            />
          </div>
        ) : null}
      </div>

      <!-- Description Section - match original styling -->
      <div class="order-2">
        <div class="bg-white">
          <p class="text-base text-gray-700 leading-relaxed">
            {description}
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Image Section -->
{featuredImage && (
  <section class="bg-white py-12">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <Image 
          src={featuredImage} 
          alt={title}
          width={800}
          height={600}
          class="w-full h-auto rounded-lg shadow-md"
        />
      </div>
    </div>
  </section>
)} 