---
// Handle legacy WordPress-style URLs with date structure like /2023/06/28/...
// This is a catch-all for any 2023 dated URLs

import { getCollection } from 'astro:content';

// Get all news articles to create a mapping
const newsArticles = await getCollection('news');

// Create a mapping of date patterns to news article slugs
const dateToSlugMapping: Record<string, string> = {};
newsArticles.forEach(article => {
  const publishDate = new Date(article.data.publishDate);
  const year = publishDate.getFullYear().toString();
  const month = (publishDate.getMonth() + 1).toString().padStart(2, '0');
  const day = publishDate.getDate().toString().padStart(2, '0');
  
  if (year === '2023') {
    const dateKey = `${month}/${day}`;
    dateToSlugMapping[dateKey] = article.slug;
  }
});

// For static generation, we can't predict all possible paths, so we'll handle common ones
export async function getStaticPaths() {
  return [
    // 2023 date paths from sitemap
    { params: { path: '06/28/aesop-ai-workshop' } },
    { params: { path: '09/13/coding-education' } },
    { params: { path: '09/14/formula-ai-2024' } },
    { params: { path: '03/03/skhtst' } },
    { params: { path: '03/20/jordan-model-car-play-area' } },
    { params: { path: '05/23/ai-art-competition' } },
    { params: { path: '06/05/skhlfh' } },
    { params: { path: '06/13/mkpcollege-sdd' } },
    { params: { path: '07/28/hkage-15th-anniversary' } },
    { params: { path: '07/30/know-it-it-lab-solution-day' } },
    { params: { path: '08/22/ai-art-ceremony-exhibition' } },
    { params: { path: '08/25/jpmorgan-ai-generative-art-workshop' } },
    { params: { path: '08/30/microbit-cckln' } },
    { params: { path: '08/30/minecraft-2023' } },
    { params: { path: '09/28/yy1-sdd' } },
    { params: { path: '09/29/keiwan-sdd' } },
    { params: { path: '12/02/formula-ai-2024-1st-wcmss' } }
  ];
}

const { path } = Astro.params;

// Extract date from path (MM/DD format)
const dateMatch = path?.match(/^(\d{2})\/(\d{2})\//);
if (dateMatch) {
  const month = dateMatch[1];
  const day = dateMatch[2];
  const dateKey = `${month}/${day}`;
  
  // Check if we have a matching news article for this date
  if (dateToSlugMapping[dateKey]) {
    return Astro.redirect(`/news/${encodeURIComponent(dateToSlugMapping[dateKey])}`);
  }
}

// Default redirect to news index for any other 2023 URLs
return Astro.redirect('/news');
---

<!-- This file should never render content as it only handles redirects -->
