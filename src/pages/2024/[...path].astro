---
// Handle legacy WordPress-style URLs with date structure like /2024/04/15/...
// This is a catch-all for any 2024 dated URLs

import { getCollection } from 'astro:content';

// Get all news articles to create a mapping
const newsArticles = await getCollection('news');

// Create a mapping of date patterns to news article slugs
const dateToSlugMapping: Record<string, string> = {};
newsArticles.forEach(article => {
  const publishDate = new Date(article.data.publishDate);
  const year = publishDate.getFullYear().toString();
  const month = (publishDate.getMonth() + 1).toString().padStart(2, '0');
  const day = publishDate.getDate().toString().padStart(2, '0');
  
  if (year === '2024') {
    const dateKey = `${month}/${day}`;
    dateToSlugMapping[dateKey] = article.slug;
  }
});

// For static generation, we can't predict all possible paths, so we'll handle common ones
export async function getStaticPaths() {
  return [
    // Common redirects we know about
    { params: { path: '04/15/ai-art-competition-2024-ceremony-and-exhibition-recap' } },
    { params: { path: '04/15/ai-x-ceremony-and-exhibition' } },
    // Add the specific Chinese character path that's causing the 404
    { params: { path: '04/15/【ai-x-中華文化-x-視覺藝術】校際ai藝術創作大賽-2024《數' } },
    // Add more 2024 date paths from sitemap
    { params: { path: '02/06/web3-blockchain-education' } },
    { params: { path: '02/19/ai-art-storybook-music-design' } },
    { params: { path: '03/23/formula-ai-2024-3rd-maryknoll' } },
    { params: { path: '03/30/葛量洪校友會黃埔學校-教師培訓講座' } },
    { params: { path: '05/03/digital-economy-summit-forum' } },
    { params: { path: '05/30/ai-parent-education-workshop' } },
    { params: { path: '06/07/space-exploration-tech-feast' } },
    { params: { path: '06/07/primary-school-ai-teaching-efficiency' } },
    { params: { path: '06/19/space-exploration-baptist-primary' } },
    { params: { path: '06/20/drone-experience-kalingpb' } },
    { params: { path: '06/21/30th-anniversary-tech-carnival' } },
    { params: { path: '06/23/tech-dreams-sailing-skh' } },
    { params: { path: '06/25/tech-innovation-cross-curricular' } },
    { params: { path: '06/27/tech-innovation-future-challenge' } },
    { params: { path: '07/02/aerospace-tech-unlimited-potential' } },
    { params: { path: '07/03/ai-digital-animation-journey' } },
    { params: { path: '07/05/ai-tech-creativity-fusion' } },
    { params: { path: '07/10/cospaces-exploration-rainbow' } },
    { params: { path: '07/26/unlimited-creativity-ai-animation' } },
    { params: { path: '07/29/brand-new-drone-experience' } },
    { params: { path: '09/02/ai-tech-teaching-efficiency' } },
    { params: { path: '09/02/minecraft-inclusive-world' } },
    { params: { path: '09/04/minecraft-tianbaoming-principal' } },
    { params: { path: '09/04/minecraft-red-cross-kennedy' } },
    { params: { path: '09/10/hsbc-community-innovation-hackathon' } },
    { params: { path: '10/05/ai-art-hong-kong-tourism' } },
    { params: { path: '10/18/macau-study-tour-ai-art' } },
    { params: { path: '12/10/parents-learn-ai-practical-skills' } }
  ];
}

const { path } = Astro.params;

// Extract date from path (MM/DD format)
const dateMatch = path?.match(/^(\d{2})\/(\d{2})\//);
if (dateMatch) {
  const month = dateMatch[1];
  const day = dateMatch[2];
  const dateKey = `${month}/${day}`;
  
  // Check if we have a matching news article for this date
  if (dateToSlugMapping[dateKey]) {
    return Astro.redirect(`/news/${encodeURIComponent(dateToSlugMapping[dateKey])}`);
  }
}

// Check if this is the AI art competition article (legacy handling)
if (path && (
  path.includes('ai-art-competition-2024') || 
  path.includes('ai-x') ||
  path.includes('04/15')
)) {
  // Use URL encoding to handle Chinese characters in redirect
  const encodedSlug = '2024-04-15-ai-x-%E4%B8%AD%E8%8F%AF%E6%96%87%E5%8C%96-x-%E8%A6%96%E8%A6%BA%E8%97%9D%E8%A1%93%E6%A0%A1%E9%9A%9Bai%E8%97%9D%E8%A1%93%E5%89%B5%E4%BD%9C%E5%A4%A7%E8%B3%BD-2024%E6%95%B8%E7%A2%BC%E8%A9%A0%E5%8F%A4%E5%AE%8C%E6%BB%BF%E8%90%BD%E5%B9%95';
  return Astro.redirect(`/news/${encodedSlug}`);
}

// Default redirect to news index for any other 2024 URLs
return Astro.redirect('/news');
---

<!-- This file should never render content as it only handles redirects -->