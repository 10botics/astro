---
import Layout from '../../layouts/Layout.astro';
import { Image } from 'astro:assets';
import { 
  discoverCourses, 
  generateTagSlug,
  AUDIENCE_TAG_MAPPING,
  filterCoursesByTag,
  type Course 
} from '../../utils/courseMappings';

// Import background image
import aiCoursesImage from '../../assets/images/index/ai-courses.jpg';

// Auto-discover courses using shared utility
const astroCourses = await discoverCourses('../school-courses/', ['index.astro', '[slug].astro']);

// Filter for science handicraft courses only
const scienceHandicraftCourses = filterCoursesByTag(astroCourses, 'science-handicraft', 'ç§‘å­¸æ‰‹ä½œ');

// Sort courses by publication date (newest first)
const sortedCourses = scienceHandicraftCourses.sort((a, b) => 
  new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime()
);

// SEO optimized page data
const pageTitle = "ç§‘å­¸æ‰‹ä½œèª²ç¨‹ - 10æ•™è‚²æ¢ç´¢ç§‘å­¸èˆ‡è—è¡“";
const pageDescription = `æ¢ç´¢æˆ‘å€‘çš„ç§‘å­¸æ‰‹ä½œèª²ç¨‹ï¼Œçµåˆè‡ªç„¶ç§‘å­¸ã€ç”Ÿç‰©æ¢ç©¶èˆ‡å‰µæ„æ‰‹ä½œã€‚å…±${sortedCourses.length}å€‹èª²ç¨‹ï¼Œè®“å­¸ç”Ÿåœ¨å‹•æ‰‹ä¸­å­¸ç¿’ç§‘å­¸çŸ¥è­˜ã€‚`;
const pageKeywords = "ç§‘å­¸æ‰‹ä½œ, è‡ªç„¶ç§‘å­¸èª²ç¨‹, ç”Ÿç‰©æ¢ç©¶, æµ·æ´‹ç’°å¢ƒ, å‰µæ„æ‰‹ä½œ, STEMæ•™è‚², 10æ•™è‚²";
---

<Layout 
  title={pageTitle}
  description={pageDescription}
  keywords={pageKeywords}
  ogImage="/images/og/science-courses.jpg"
>
  <main class="courses-index">
    <!-- Header -->
    <header class="relative text-white py-16 overflow-hidden">
      <div class="absolute inset-0">
        <Image src={aiCoursesImage} alt="ç§‘å­¸æ‰‹ä½œèª²ç¨‹èƒŒæ™¯" class="w-full h-full object-cover" />
        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
      </div>
      <div class="relative container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <h1 class="text-5xl font-bold mb-6">ç§‘å­¸æ‰‹ä½œèª²ç¨‹</h1>
          <p class="text-xl opacity-90 mb-8">
            æ¢ç´¢è‡ªç„¶ç§‘å­¸èˆ‡å‰µæ„æ‰‹ä½œçš„å®Œç¾çµåˆï¼Œè®“å­¸ç”Ÿåœ¨å‹•æ‰‹å¯¦è¸ä¸­å­¸ç¿’ç§‘å­¸çŸ¥è­˜
          </p>
          <div class="flex flex-wrap justify-center gap-4 mt-8">
            <div class="bg-white bg-opacity-20 backdrop-blur-sm px-6 py-3 rounded-lg">
              <div class="text-3xl font-bold">{sortedCourses.length}</div>
              <div class="text-sm opacity-90">ç§‘å­¸æ‰‹ä½œèª²ç¨‹</div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Course Description -->
    <section class="py-12 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <h2 class="text-3xl font-bold mb-6 text-gray-800">ä»€éº¼æ˜¯ç§‘å­¸æ‰‹ä½œèª²ç¨‹ï¼Ÿ</h2>
          <p class="text-lg text-gray-600 leading-relaxed mb-4">
            ç§‘å­¸æ‰‹ä½œèª²ç¨‹çµåˆè‡ªç„¶ç§‘å­¸çŸ¥è­˜èˆ‡å‰µæ„æ‰‹å·¥è£½ä½œï¼Œè®“å­¸ç”Ÿé€éå¯¦éš›æ“ä½œæ¢ç´¢ç§‘å­¸åŸç†ã€‚
            èª²ç¨‹æ¶µè“‹ç”Ÿç‰©å­¸ã€ç’°å¢ƒç§‘å­¸ã€æµ·æ´‹ç”Ÿæ…‹ç­‰ä¸»é¡Œï¼ŒåŸ¹é¤Šå­¸ç”Ÿçš„è§€å¯ŸåŠ›ã€å‰µé€ åŠ›èˆ‡ç§‘å­¸æ¢ç©¶ç²¾ç¥ã€‚
          </p>
          <p class="text-lg text-gray-600 leading-relaxed">
            é©åˆå°è‡ªç„¶ç§‘å­¸å’Œå‹•æ‰‹å‰µä½œæ„Ÿèˆˆè¶£çš„å­¸ç”Ÿï¼Œé€šéè£½ä½œå„ç¨®ç§‘å­¸æ‰‹å·¥ä½œå“ï¼Œ
            æ·±å…¥äº†è§£å‹•æ¤ç‰©ç‰¹å¾µã€ç”Ÿæ…‹ç³»çµ±å’Œç’°å¢ƒä¿è­·çš„é‡è¦æ€§ã€‚
          </p>
        </div>
      </div>
    </section>

    <!-- All Science Courses -->
    <section class="py-16">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <h2 class="text-3xl font-bold mb-8 text-gray-800 text-center">æ¢ç´¢æˆ‘å€‘çš„ç§‘å­¸æ‰‹ä½œèª²ç¨‹</h2>
          
          {sortedCourses.length > 0 ? (
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {sortedCourses.map((course) => (
                <article class="course-card bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden">
                  <!-- Hero Image -->
                  {course.heroImage && (
                    <div class="course-image-container bg-gray-100 overflow-hidden aspect-video">
                      {typeof course.heroImage === 'string' ? (
                        <Image 
                          src={course.heroImage} 
                          alt={course.title}
                          width={600}
                          height={400}
                          class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                        />
                      ) : (
                        <Image 
                          src={course.heroImage} 
                          alt={course.title}
                          width={600}
                          height={400}
                          class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                        />
                      )}
                    </div>
                  )}
                  <div class="p-6">
                    <!-- Course Header -->
                    <div class="mb-4">
                      <h3 class="text-xl font-bold mb-2 text-gray-800 line-clamp-2">
                        <a href={`/school-courses/${course.slug}`} 
                           class="hover:text-blue-600 transition-colors">
                          {course.title}
                        </a>
                      </h3>
                      
                      {course.description && (
                        <p class="text-gray-600 text-sm line-clamp-3 mb-4">
                          {course.description}
                        </p>
                      )}
                    </div>
                    
                    <!-- Tags -->
                    <div class="mb-4">
                      {(() => {
                        const targetAudienceTags = ['åˆå°', 'é«˜å°', 'åˆä¸­', 'é«˜ä¸­'];
                        const otherTags = course.tags.filter(tag => !targetAudienceTags.includes(tag));
                        const audienceTags = course.tags.filter(tag => targetAudienceTags.includes(tag));
                        
                        return (
                          <div class="space-y-2">
                            {/* Target Audience */}
                            {audienceTags.length > 0 && (
                              <div class="flex flex-wrap gap-1 items-center">
                                <span class="text-xs font-medium text-gray-600 mr-1">é©åˆå°è±¡:</span>
                                {audienceTags.map(tag => {
                                  const tagSlug = AUDIENCE_TAG_MAPPING[tag] || tag.toLowerCase().replace(/\s+/g, '-');
                                  
                                  return (
                                    <a href={`/school-courses/tag/${tagSlug}`} class="bg-cyan-100 text-cyan-800 px-2 py-1 rounded text-xs font-medium hover:bg-cyan-200 transition-colors">
                                      {tag}
                                    </a>
                                  );
                                })}
                              </div>
                            )}
                            
                            {/* Other Tags */}
                            {otherTags.length > 0 && (
                              <div class="flex flex-wrap gap-1">
                                {otherTags.map(tag => {
                                  // Generate tag slug using shared utility
                                  const tagSlug = generateTagSlug(tag);
                                  
                                  return (
                                    <a href={`/school-courses/tag/${tagSlug}`}
                                       class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium hover:bg-blue-200 transition-colors">
                                      {tag}
                                    </a>
                                  );
                                })}
                              </div>
                            )}
                          </div>
                        );
                      })()}
                    </div>
                    
                    <!-- Action Button -->
                    <div class="mt-auto">
                      <a href={`/school-courses/${course.slug}`}
                         class="inline-block w-full text-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors text-sm font-medium">
                        æŸ¥çœ‹èª²ç¨‹è©³æƒ…
                      </a>
                    </div>
                  </div>
                </article>
              ))}
            </div>
          ) : (
            <div class="text-center py-12">
              <p class="text-xl text-gray-600">ç›®å‰å°šç„¡ç§‘å­¸æ‰‹ä½œèª²ç¨‹</p>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Why Choose Science Courses -->
    <section class="py-16 bg-gradient-to-br from-blue-50 to-green-50">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <h2 class="text-3xl font-bold mb-12 text-gray-800 text-center">ç‚ºä»€éº¼é¸æ“‡æˆ‘å€‘çš„ç§‘å­¸æ‰‹ä½œèª²ç¨‹ï¼Ÿ</h2>
          <div class="grid md:grid-cols-3 gap-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
              <div class="text-4xl mb-4">ğŸ”¬</div>
              <h3 class="text-xl font-bold mb-3 text-gray-800">å¯¦è¸èˆ‡ç†è«–çµåˆ</h3>
              <p class="text-gray-600">
                é€šéå‹•æ‰‹è£½ä½œå’Œå¯¦é©—ï¼Œå°‡æŠ½è±¡çš„ç§‘å­¸æ¦‚å¿µè½‰åŒ–ç‚ºå…·é«”çš„å­¸ç¿’é«”é©—
              </p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <div class="text-4xl mb-4">ğŸŒ¿</div>
              <h3 class="text-xl font-bold mb-3 text-gray-800">æ¢ç´¢è‡ªç„¶ä¸–ç•Œ</h3>
              <p class="text-gray-600">
                æ·±å…¥äº†è§£å‹•æ¤ç‰©ã€ç”Ÿæ…‹ç³»çµ±å’Œç’°å¢ƒç§‘å­¸ï¼ŒåŸ¹é¤Šå°è‡ªç„¶çš„ç†±æ„›å’Œä¿è­·æ„è­˜
              </p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
              <div class="text-4xl mb-4">ğŸ¨</div>
              <h3 class="text-xl font-bold mb-3 text-gray-800">æ¿€ç™¼å‰µé€ åŠ›</h3>
              <p class="text-gray-600">
                çµåˆè—è¡“èˆ‡ç§‘å­¸ï¼Œè®“å­¸ç”Ÿåœ¨å‰µä½œä¸­å±•ç¾å€‹æ€§ï¼ŒåŸ¹é¤Šå‰µæ–°æ€ç¶­
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<!-- Styles are now centralized in src/styles/school-courses.css -->

