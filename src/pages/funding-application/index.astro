---
import Layout from '../../layouts/Layout.astro';
import { Image } from 'astro:assets';
import { 
  discoverCourses, 
  generateTagSlug,
  AUDIENCE_TAG_MAPPING,
  type Course 
} from '../../utils/courseMappings';

// Import images
import itLabBanner from '../../assets/images/funding-application/IT創新實驗室計劃/it_lab_main_page_banner_tc-1024x439.jpg';

const title = "資助申請 - 10教育";
const description = "了解各種教育資助計劃，包括IT創新實驗室計劃等，協助學校獲得資金支持。";

// Auto-discover courses using shared utility
const astroCourses = await discoverCourses('../school-courses/', ['index.astro', '[slug].astro']);

// Sort courses by publication date (newest first)
const sortedCourses = astroCourses.sort((a, b) => 
  new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime()
);
---

<Layout title={title} description={description}>
  <!-- Hero Section -->
  <section class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-20">
    <div class="container mx-auto px-4 max-w-6xl text-center">
      <h1 class="text-5xl font-bold mb-6">資助申請</h1>
      <p class="text-xl text-blue-100 max-w-3xl mx-auto">
        為學校和教育機構提供各種資助計劃的申請協助，讓您的教育項目獲得資金支持
      </p>
    </div>
  </section>

  <!-- Available Programs -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4 max-w-6xl">
      <h2 class="text-3xl font-bold text-gray-900 mb-12 text-center">可申請的資助計劃</h2>
      
      <div class="grid md:grid-cols-2 gap-8">
        <!-- IT Innovation Lab -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow">
          <div class="relative">
            <Image 
              src={itLabBanner} 
              alt="IT創新實驗室計劃" 
              class="w-full h-48 object-cover"
              width={1024}
              height={439}
            />
            <div class="absolute top-4 right-4">
              <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                熱門
              </span>
            </div>
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-3">IT創新實驗室計劃</h3>
            <p class="text-gray-600 mb-4">
              資科辦在現行的「中學資訊科技增潤計劃」下推行「中學IT創新實驗室」計劃，在新一輪的2023/24至2025/26這3個學年中，向公帑資助的中學每所提供最高100萬元的資助。
            </p>
            <div class="flex items-center justify-between">
              <div class="text-sm text-gray-500">
                <span class="font-semibold text-green-600">最高資助：</span>100萬元
              </div>
              <a 
                href="/funding-application/it-innovation-lab" 
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors"
              >
                了解詳情
              </a>
            </div>
          </div>
        </div>

        <!-- 奇趣IT識多啲計劃 -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow">
          <div class="relative">
            <div class="w-full h-48 bg-gradient-to-r from-green-400 to-blue-500 flex items-center justify-center">
              <div class="text-center text-white">
                <i class="fas fa-laptop-code text-4xl mb-2"></i>
                <p class="text-lg font-semibold">奇趣IT識多啲計劃</p>
              </div>
            </div>
            <div class="absolute top-4 right-4">
              <span class="bg-green-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                小學適用
              </span>
            </div>
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-3">奇趣IT識多啲計劃</h3>
            <p class="text-gray-600 mb-4">
              爲了透過課外活動啟發小學生對資訊科技的興趣、認識及應用，政府由2021/22到2023/24三個學年，爲每所小學提供最高共40萬元的一次性撥款資助。
            </p>
            <div class="flex items-center justify-between">
              <div class="text-sm text-gray-500">
                <span class="font-semibold text-green-600">最高資助：</span>40萬元
              </div>
              <a 
                href="/funding-application/knowing-more-about-it" 
                class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors"
              >
                了解詳情
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Choose Us -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4 max-w-6xl">
      <h2 class="text-3xl font-bold text-gray-900 mb-12 text-center">為什麼選擇我們？</h2>
      
      <div class="grid md:grid-cols-3 gap-8">
        <div class="text-center">
          <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-file-alt text-2xl text-blue-600"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">專業申請協助</h3>
          <p class="text-gray-600">
            提供完整的申請表格範本和專業指導，確保申請成功率高
          </p>
        </div>
        
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-users text-2xl text-green-600"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">經驗豐富團隊</h3>
          <p class="text-gray-600">
            擁有豐富的STEM教育經驗，了解學校需求和教育政策
          </p>
        </div>
        
        <div class="text-center">
          <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-headset text-2xl text-purple-600"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">全程支援服務</h3>
          <p class="text-gray-600">
            從申請到執行，提供全程技術支援和課程實施協助
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact CTA -->
  <section class="py-16 bg-blue-600 text-white">
    <div class="container mx-auto px-4 max-w-6xl text-center">
      <h2 class="text-3xl font-bold mb-6">準備好開始申請了嗎？</h2>
      <p class="text-xl text-blue-100 mb-8">
        聯絡我們的專業團隊，獲得最適合您學校的資助計劃建議
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href="/funding-application/IT創新實驗室計劃" 
          class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors"
        >
          IT創新實驗室計劃
        </a>
        <a 
          href="/funding-application/奇趣IT識多啲計劃" 
          class="bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors"
        >
          奇趣IT識多啲計劃
        </a>
        <a 
          href="/contact" 
          class="border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-blue-600 transition-colors"
        >
          聯絡我們
        </a>
      </div>
    </div>
  </section>

  <!-- Available Courses -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4 max-w-6xl">
      <h2 class="text-3xl font-bold text-gray-900 mb-12 text-center">可選課程清單</h2>
      <p class="text-lg text-gray-700 text-center mb-8 max-w-4xl mx-auto">
        以下課程均符合各項資助計劃要求，可協助學校提升資訊科技設備和設施，以及舉辦與資訊科技相關的課外活動
      </p>
      
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {sortedCourses.map((course) => (
          <article class="course-card bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden">
            <!-- Hero Image -->
            {course.heroImage && (
              <div class="course-image-container bg-gray-100 overflow-hidden aspect-video">
                {typeof course.heroImage === 'string' ? (
                  <Image 
                    src={course.heroImage} 
                    alt={course.title}
                    width={600}
                    height={400}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  />
                ) : (
                  <Image 
                    src={course.heroImage} 
                    alt={course.title}
                    width={600}
                    height={400}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  />
                )}
              </div>
            )}
            <div class="p-6">
              <!-- Course Header -->
              <div class="mb-4">
                <h3 class="text-xl font-bold mb-2 text-gray-800 line-clamp-2">
                  <a href={`/school-courses/${course.slug}`} 
                     class="hover:text-blue-600 transition-colors">
                    {course.title}
                  </a>
                </h3>
                
                {course.description && (
                  <p class="text-gray-600 text-sm line-clamp-3 mb-4">
                    {course.description}
                  </p>
                )}
              </div>
              
              <!-- Tags -->
              <div class="mb-4">
                {(() => {
                  const targetAudienceTags = ['初小', '高小', '初中', '高中'];
                  const otherTags = course.tags.filter(tag => !targetAudienceTags.includes(tag));
                  const audienceTags = course.tags.filter(tag => targetAudienceTags.includes(tag));
                  
                  return (
                    <div class="space-y-2">
                      {/* Target Audience */}
                      {audienceTags.length > 0 && (
                        <div class="flex flex-wrap gap-1 items-center">
                          <span class="text-xs font-medium text-gray-600 mr-1">適合對象:</span>
                          {audienceTags.map(tag => {
                            const tagSlug = AUDIENCE_TAG_MAPPING[tag] || tag.toLowerCase().replace(/\s+/g, '-');
                            
                            return (
                              <a href={`/school-courses/tag/${tagSlug}`} class="bg-cyan-100 text-cyan-800 px-2 py-1 rounded text-xs font-medium hover:bg-cyan-200 transition-colors">
                                {tag}
                              </a>
                            );
                          })}
                        </div>
                      )}
                      
                      {/* Other Tags */}
                      {otherTags.length > 0 && (
                        <div class="flex flex-wrap gap-1">
                          {otherTags.map(tag => {
                            // Generate tag slug using shared utility
                            const tagSlug = generateTagSlug(tag);
                            
                            return (
                              <a href={`/school-courses/tag/${tagSlug}`}
                                 class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium hover:bg-blue-200 transition-colors">
                                {tag}
                              </a>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  );
                })()}
              </div>
              
              <!-- Action Button -->
              <div class="mt-auto">
                <a href={`/school-courses/${course.slug}`}
                   class="inline-block w-full text-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors text-sm font-medium">
                  查看課程詳情
                </a>
              </div>
            </div>
          </article>
        ))}
      </div>

      <div class="text-center mt-8">
        <a href="/school-courses/" class="inline-block bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
          查看所有課程
        </a>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Font Awesome icons */
  .fas, .fab, .far {
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
  }
  
  .fab {
    font-weight: 400;
  }
</style>
