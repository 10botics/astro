---
// Dynamic route to handle redirections from stem-day/ to stemday/

export async function getStaticPaths() {
  // Map of stem-day slugs to stemday slugs
  const slugMapping = {
    'index': '',
    '飲管橋': 'straw-bridge',
    'DIY-手作': 'diy',
    'matatalab-入門編程課程': 'matatalab-programming',
    'straw-bridge': 'straw-bridge',
    'diy': 'diy',
    'matatalab-programming': 'matatalab-programming',
    'matatalab': 'matatalab-programming',
    'microbit-parachute': 'microbit-parachute'
  };
  return Object.keys(slugMapping).map(slug => ({
    params: { slug }
  }));
}

const { slug } = Astro.params;

if (!slug) {
  throw new Error('Slug is required');
}

// Get target slug from mapping
const slugMapping: Record<string, string> = {
  'index': '',
  '飲管橋': 'straw-bridge',
  'DIY-手作': 'diy',
  'matatalab-入門編程課程': 'matatalab-programming',
  'straw-bridge': 'straw-bridge',
  'diy': 'diy',
  'matatalab-programming': 'matatalab-programming',
  'matatalab': 'matatalab-programming',
  'microbit-parachute': 'microbit-parachute'
};
const targetSlug = slugMapping[slug];

if (targetSlug === undefined) {
  throw new Error(`Unknown stem-day slug: ${slug}`);
}

// All stem-day routes should redirect to stemday
const redirectPath = targetSlug === '' 
  ? '/stemday/' 
  : `/stemday/${targetSlug}/`;

return Astro.redirect(redirectPath, 301);
---
