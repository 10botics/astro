---
// Dynamic route to handle URL mapping for STEM day activities

// Pre-import all components to avoid Unicode issues in dynamic imports
import StrawBridge from './飲管橋.astro';
import DIY from './DIY 手作.astro';
import Matatalab from './Matatalab 入門編程課程.astro';
import MicrobitParachute from '../school-courses/Microbit 降落傘課程.astro';
import Index from './index.astro';

// Component mapping by filename
const componentMap = {
  '飲管橋.astro': StrawBridge,
  'DIY 手作.astro': DIY,
  'Matatalab 入門編程課程.astro': Matatalab,
  'Microbit 降落傘課程.astro': MicrobitParachute,
  'index.astro': Index
};

export async function getStaticPaths() {
  // Canonical slug to filename mapping (stemday)
  const slugToFilenameMap = {
    'straw-bridge': '飲管橋.astro',
    'diy': 'DIY 手作.astro',
    'matatalab-programming': 'Matatalab 入門編程課程.astro',
    'microbit-parachute': 'Microbit 降落傘課程.astro',
    'index': 'index.astro'
  };
  return Object.keys(slugToFilenameMap).map(slug => ({
    params: { slug }
  }));
}

const { slug } = Astro.params;

if (!slug) {
  throw new Error('Slug is required');
}

// Get filename from canonical slug mapping
const slugToFilenameMap = {
  'straw-bridge': '飲管橋.astro',
  'diy': 'DIY 手作.astro',
  'matatalab-programming': 'Matatalab 入門編程課程.astro',
  'microbit-parachute': 'Microbit 降落傘課程.astro',
  'index': 'index.astro'
};
const filename = slugToFilenameMap[slug];

if (!filename) {
  throw new Error(`Unknown stemday slug: ${slug}`);
}

// Get the pre-imported component
const StemdayComponent = filename in componentMap 
  ? componentMap[filename as keyof typeof componentMap]
  : null;

if (!StemdayComponent) {
  throw new Error(`Component not found for filename: ${filename}`);
}
---

<StemdayComponent /> 