---
// Dynamic route to handle URL mapping for STEM day activities
import { getStaticPathsForFolder, getComponentForSlug } from '../../utils/urlAliases.js';

// Pre-import all components to avoid Unicode issues in dynamic imports
import StrawBridge from './飲管橋.astro';
import DIY from './DIY 手作.astro';
import Matatalab from './Matatalab 入門編程課程.astro';
import MicrobitParachute from '../school-courses/Microbit 降落傘課程.astro';
import Index from './index.astro';

// Component mapping - keys must match exactly what getComponentForSlug returns
const componentMap = {
  '飲管橋.astro': StrawBridge,
  'DIY 手作.astro': DIY,
  'Matatalab 入門編程課程.astro': Matatalab,
  'Microbit 降落傘課程.astro': MicrobitParachute,
  'index.astro': Index
};

export async function getStaticPaths() {
  return getStaticPathsForFolder('stemday');
}

const { slug } = Astro.params;
const stemdayInfo = getComponentForSlug('stemday', slug);

if (!stemdayInfo) {
  throw new Error(`Unknown stemday slug: ${slug}`);
}

// Handle redirects
if (stemdayInfo.isRedirect && stemdayInfo.redirect) {
  return Astro.redirect(stemdayInfo.redirect);
}

// Get the pre-imported component and assign to a static identifier
const StemdayComponent = componentMap[stemdayInfo.filename as keyof typeof componentMap];

if (!StemdayComponent) {
  throw new Error(`Component not found for filename: ${stemdayInfo.filename}`);
}
---

<StemdayComponent /> 