---
// Handle legacy WordPress-style URLs with date structure like /2025/03/21/...
// This is a catch-all for any 2025 dated URLs

import { getCollection } from 'astro:content';

// Get all news articles to create a mapping
const newsArticles = await getCollection('news');

// Create a mapping of date patterns to news article slugs
const dateToSlugMapping: Record<string, string> = {};
newsArticles.forEach(article => {
  const publishDate = new Date(article.data.publishDate);
  const year = publishDate.getFullYear().toString();
  const month = (publishDate.getMonth() + 1).toString().padStart(2, '0');
  const day = publishDate.getDate().toString().padStart(2, '0');
  
  if (year === '2025') {
    const dateKey = `${month}/${day}`;
    dateToSlugMapping[dateKey] = article.slug;
  }
});

// For static generation, we can't predict all possible paths, so we'll handle common ones
export async function getStaticPaths() {
  return [
    // 2025 date paths from sitemap
    { params: { path: '03/21/如何利用ai提升學習效能' } },
    { params: { path: '03/31/wusiukuiprimaryschool-national-security-talk' } },
    { params: { path: '04/16/活動回顧10教育成功在順德聯誼總會李金小學舉辦' } },
    { params: { path: '05/30/ai-parent-workshop-po-leung-kuk-school' } },
    { params: { path: '01/03/national_security_ai_security_lcp_talk' } },
    { params: { path: '01/23/ai-national-security-talk-secondary-school-2025' } },
    { params: { path: '07/22/steam-ai-donkey-car-workshop-hk-teachers' } }
  ];
}

const { path } = Astro.params;

// Extract date from path (MM/DD format)
const dateMatch = path?.match(/^(\d{2})\/(\d{2})\//);
if (dateMatch) {
  const month = dateMatch[1];
  const day = dateMatch[2];
  const dateKey = `${month}/${day}`;
  
  // Check if we have a matching news article for this date
  if (dateToSlugMapping[dateKey]) {
    return Astro.redirect(`/news/${encodeURIComponent(dateToSlugMapping[dateKey])}`);
  }
}

// Default redirect to news index for any other 2025 URLs
return Astro.redirect('/news');
---

<!-- This file should never render content as it only handles redirects -->
